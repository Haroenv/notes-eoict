MPASM 5.61                      ../EXTRA.ASM   3-4-2015  10:01:34         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001 ;******************************************************************************
                      00002 ;       Dit bestand is een basis template om assembler code te schrijven voor de 
                      00003 ;       PIC18F4550. Het is speciaal aangepast om gebruik te kunnen maken van de
                      00004 ;       HID bootloader en toch simulatie toe te laten
                      00005 ;
                      00006 ;******************************************************************************
                      00007 ;                                                                             *
                      00008 ;    Files required:         P18F4550.INC                                     *
                      00009 ;                            dwengo.LKR                                                                 
                                              *
                      00010 ;                                                                                                       
                                                                      *
                      00011 ;                                                                             *
                      00012 ;                                                                             *
                      00013 ;******************************************************************************
                      00014 
                      00015         LIST P=18F4550, F=INHX32        ;directive to define processor
Error[105]  : Cannot open file (Include File "P18F4550.INC" not found)
                      00016         #include <P18F4550.INC> ;processor specific variable definitions
                      00017 
                      00018 
                      00019 
                      00020 ; definitie variabelen
                      00021                 UDATA 0x300
                      00022 
000300                00023 WREG_TEMP       RES     1       ;variable in RAM for context saving 
000301                00024 STATUS_TEMP     RES     1       ;variable in RAM for context saving
000302                00025 BSR_TEMP        RES     1       ;variable in RAM for context saving
                      00026 
000303                00027 DVAR1           RES 1
000304                00028 DVAR2           RES 1
000305                00029 DVAR3           RES 1
                      00030 
000306                00031 honderdtal      RES 1
000307                00032 tiental         RES 1
000308                00033 eenheid         RES 1
000309                00034 deeltal         RES 1
00030A                00035 quotient        RES 1
                      00036 
00030B                00037 voorbeeld       RES 1   ;op deze manier maak je een geheugenplaats van 1 byte die je kan gebruiken via d
                            e naam "voorbeeld"
                      00038 
                      00039 ;hier eventueel extra variabelen toevoegen
                      00040 
00030C                00041 getal1      RES 1
00030D                00042 getal2          RES 1
00030E                00043 som                     RES 2
                      00044 
                      00045 ; Access Bank
                      00046 
                      00047                 UDATA_ACS
                      00048 
000000                00049 EXAMPLE         RES     1       ; example of a variable in access RAM
MPASM 5.61                      ../EXTRA.ASM   3-4-2015  10:01:34         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00050 
                      00051 
                      00052 
                      00053 ;******************************************************************************
                      00054 ;EEPROM data
                      00055 ; Data to be programmed into the Data EEPROM is defined here
                      00056 
                      00057 
                      00058 DATA_EEPROM     CODE    0xf00000
                      00059 
                      00060         ;       DE      "Test Data",0,1,2,3,4,5
                      00061 
                      00062 ;******************************************************************************
                      00063 ;Reset vector
                      00064 ; This code will start executing when a reset occurs.
                      00065         org 0x0
000000 EF00 F010      00066         goto 0x2000
                      00067 
                      00068         org 0x08
000008 EF04 F010      00069         goto 0x2008
                      00070 
                      00071         org 0x18
000018 EF0C F010      00072         goto 0x2018
                      00073 
                      00074 
                      00075 RESET_VECTOR    CODE    0x2000
002000 0103           00076                 movlb   0x03
002002 EF?? F???      00077                 goto    Main            ;go to start of main code
                      00078 
                      00079 HI_INT_VECTOR   CODE    0x2008
                      00080 
002008 EF?? F???      00081                 goto    HighInt         ;go to high priority interrupt routine
                      00082 
                      00083 LOW_INT_VECTOR  CODE    0x2018
                      00084 
002018 EF?? F???      00085                 goto    LowInt          ;go to low priority interrupt routine
                      00086 
                      00087 ;******************************************************************************
                      00088 ;High priority interrupt routine
                      00089 ; The high priority interrupt code is placed here to avoid conflicting with
                      00090 ; the low priority interrupt vector.
                      00091                 CODE
                      00092 
000000                00093 HighInt:
                      00094 
Error[113]  : Symbol not previously defined (FAST)
000000 0010           00095         Retfie FAST
                      00096 
                      00097 
                      00098 ;******************************************************************************
                      00099 ;Low priority interrupt routine
                      00100 ; The low priority interrupt code is placed here.
                      00101 ; This code can be removed if low priority interrupts are not used.
MPASM 5.61                      ../EXTRA.ASM   3-4-2015  10:01:34         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

000002                00102 LowInt:
Error[113]  : Symbol not previously defined (STATUS)
000002 C000 F???      00103                 movff   STATUS,STATUS_TEMP      ;save STATUS register
Error[113]  : Symbol not previously defined (WREG)
000006 C000 F???      00104                 movff   WREG,WREG_TEMP          ;save working register
Error[113]  : Symbol not previously defined (BSR)
00000A C000 F???      00105                 movff   BSR,BSR_TEMP            ;save BSR register
                      00106 
                      00107 ;       *** low priority interrupt code goes here ***
                      00108 
                      00109 
Error[113]  : Symbol not previously defined (BSR)
00000E C??? F000      00110                 movff   BSR_TEMP,BSR            ;restore BSR register
Error[113]  : Symbol not previously defined (WREG)
000012 C??? F000      00111                 movff   WREG_TEMP,WREG          ;restore working register
Error[113]  : Symbol not previously defined (STATUS)
000016 C??? F000      00112                 movff   STATUS_TEMP,STATUS      ;restore STATUS register
00001A 0010           00113                 retfie
                      00114 
                      00115 ;******************************************************************************
                      00116 ; Hoofdprogramma
                      00117 ; Schrijf al je code onder het label main
                      00118 ; subroutines voeg je onderaan toe
                      00119 ; macro's bovenaan
                      00120 
00001C                00121 Main:
                      00122 
                      00123 ; ===========
                      00124 ; MACRO's
                      00125 ; ===========
                      00126 
                      00127 #include "macro.asm"
                      00001 ; ===========
                      00002 ; MACRO's
                      00003 ; ===========
                      00004 
                      00005 
                      00006 ; INITIALISATIE LCD op Dwengo bord
                      00007 ; ================================
                      00008 LCD_Init Macro
                      00009 ; poorten instellen LCD (Dwengo)
                      00010         movlw   0Ah 
                      00011         movwf   ADCON1          ; RBE als digitale poorten
                      00012 
                      00013         clrf    TRISD           ; poort D = data LCD
                      00014         bcf             TRISC,0         ; LED verlichting LCD
                      00015 
                      00016         bcf             TRISE,0     ; RS
                      00017 ;       bcf             TRISE,1         ; RW (aan GND bij enkel schrijven)
                      00018         bcf             TRISE,2         ; E     
                      00019         
                      00020 ; achtergrondverlichting aan
                      00021         bsf             LATC,0
MPASM 5.61                      ../EXTRA.ASM   3-4-2015  10:01:34         PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00022 
                      00023 ; wachten op stabilisatie LCD bij aanleggen voedingsspanning
                      00024         movlw   0xFF
                      00025         movwf   DVAR3
                      00026 DelayLang:
                      00027         call    DelayLCD                
                      00028         decfsz  DVAR3
                      00029         goto    DelayLang
                      00030 
                      00031 ; LCD initialiseren
                      00032         bcf             LATE,0          ; RS laag
                      00033         bcf             LATE,2          ; E laag
                      00034         
                      00035         movlw   B'00000001'     ; clear display
                      00036         movwf   LATD
                      00037         call    Epuls
                      00038 
                      00039         movlw   B'00111000'     ; interface length: byte, 2 lijnen, 5x7 dots
                      00040         movwf   LATD
                      00041         call    Epuls
                      00042 
                      00043         movlw   B'00001100'     ; display aan, geen cursor, geen blinking
                      00044         movwf   LATD
                      00045         call    Epuls
                      00046 
                      00047         movlw   B'00000110'     ; richting cursorpositie
                      00048         movwf   LATD
                      00049         call    Epuls
                      00050 
                      00051         movlw   B'00000001'     ; clear display
                      00052         movwf   LATD
                      00053         call    Epuls
                      00054         
                      00055         EndM
                      00056 
                      00057 ; Adres op eerste lijn - LCD op Dwengo bord
                      00058 ; =========================================
                      00059 LCD_Lijn1 Macro
                      00060         bcf             LATE,0          ; RS laag
                      00061         bcf             LATE,2          ; E laag
                      00062         movlw   B'10000000'     ; move cursor to display (adres 0 = 1e lijn)
                      00063         movwf   LATD
                      00064         call    Epuls
                      00065         bsf             LATE,0          ; RS hoog
                      00066         bcf             LATE,2          ; E laag
                      00067         
                      00068         EndM
                      00069         
                      00070 ; Adres op tweede lijn - LCD op Dwengo bord
                      00071 ; =========================================
                      00072 LCD_Lijn2 Macro
                      00073         bcf             LATE,0          ; RS laag
                      00074         bcf             LATE,2          ; E laag
MPASM 5.61                      ../EXTRA.ASM   3-4-2015  10:01:34         PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00075         movlw   B'10101000'     ; move cursor to display (adres 0x28 = 2e lijn)
                      00076         movwf   LATD
                      00077         call    Epuls
                      00078         bsf             LATE,0          ; RS hoog
                      00079         bcf             LATE,2          ; E laag
                      00080         
                      00081         EndM
                      00082 
                      00083 ; Schrijven karakter naar huidige positie - LCD op Dwengo bord
                      00084 ; ============================================================
                      00085 LCD_Char MACRO karakter
                      00086         movlw   karakter
                      00087         movwf   LATD
                      00088         call    Epuls
                      00089         
                      00090         EndM
                      00091 
                      00092 
                      00093 ; Schrijven decimaal getal naar huidige positie - LCD (max. 255)
                      00094 ; ==============================================================
                      00095 
                      00096 LCD_Getal Macro getal  
                      00097         movlw   getal
                      00098         movwf   deeltal
                      00099         call    omzettingDecimaal
                      00100 
                      00101         movff   honderdtal,WREG
                      00102         addlw   '0'
                      00103         movwf   LATD
                      00104         call    Epuls
                      00105 
                      00106         movff   tiental,WREG
                      00107         addlw   '0'
                      00108         movwf   LATD
                      00109         call    Epuls
                      00110 
                      00111         movff   eenheid,WREG
                      00112         addlw   '0'
                      00113         movwf   LATD
                      00114         call    Epuls
                      00115 
                      00116         EndM
                      00128 
                      00129 ; ===============
                      00130 ; HOOFDPROGRAMMA
                      00131 ; ===============
                      00132 
Error[113]  : Symbol not previously defined (TRISD)
00001C 6A00           00133         clrf TRISD ; poort D als uitgang (LED ’s + LCD )
00001E 6A??           00134         clrf getal1
000020 6A??           00135         clrf getal2
000022 6A??           00136         clrf som
                      00137         
MPASM 5.61                      ../EXTRA.ASM   3-4-2015  10:01:34         PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00138         LCD_Init
                          M ; poorten instellen LCD (Dwengo)
000024 0E0A               M         movlw   0Ah 
Error[113]  : Symbol not previously defined (ADCON1)
000026 6E00               M         movwf   ADCON1          ; RBE als digitale poorten
                          M 
Error[113]  : Symbol not previously defined (TRISD)
000028 6A00               M         clrf    TRISD           ; poort D = data LCD
Error[113]  : Symbol not previously defined (TRISC)
00002A 9000               M         bcf             TRISC,0         ; LED verlichting LCD
                          M 
Error[113]  : Symbol not previously defined (TRISE)
00002C 9000               M         bcf             TRISE,0     ; RS
                          M ;       bcf             TRISE,1         ; RW (aan GND bij enkel schrijven)
Error[113]  : Symbol not previously defined (TRISE)
00002E 9400               M         bcf             TRISE,2         ; E     
                          M         
                          M ; achtergrondverlichting aan
Error[113]  : Symbol not previously defined (LATC)
000030 8000               M         bsf             LATC,0
                          M 
                          M ; wachten op stabilisatie LCD bij aanleggen voedingsspanning
000032 0EFF               M         movlw   0xFF
000034 6E??               M         movwf   DVAR3
000036                    M DelayLang:
000036 EC?? F???          M         call    DelayLCD                
00003A 2E??               M         decfsz  DVAR3
00003C EF?? F???          M         goto    DelayLang
                          M 
                          M ; LCD initialiseren
Error[113]  : Symbol not previously defined (LATE)
000040 9000               M         bcf             LATE,0          ; RS laag
Error[113]  : Symbol not previously defined (LATE)
000042 9400               M         bcf             LATE,2          ; E laag
                          M         
000044 0E01               M         movlw   B'00000001'     ; clear display
Error[113]  : Symbol not previously defined (LATD)
000046 6E00               M         movwf   LATD
000048 EC?? F???          M         call    Epuls
                          M 
00004C 0E38               M         movlw   B'00111000'     ; interface length: byte, 2 lijnen, 5x7 dots
Error[113]  : Symbol not previously defined (LATD)
00004E 6E00               M         movwf   LATD
000050 EC?? F???          M         call    Epuls
                          M 
000054 0E0C               M         movlw   B'00001100'     ; display aan, geen cursor, geen blinking
Error[113]  : Symbol not previously defined (LATD)
000056 6E00               M         movwf   LATD
000058 EC?? F???          M         call    Epuls
                          M 
00005C 0E06               M         movlw   B'00000110'     ; richting cursorpositie
Error[113]  : Symbol not previously defined (LATD)
00005E 6E00               M         movwf   LATD
MPASM 5.61                      ../EXTRA.ASM   3-4-2015  10:01:34         PAGE  7


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

000060 EC?? F???          M         call    Epuls
                          M 
000064 0E01               M         movlw   B'00000001'     ; clear display
Error[113]  : Symbol not previously defined (LATD)
000066 6E00               M         movwf   LATD
000068 EC?? F???          M         call    Epuls
                          M         
                      00139 
                      00140         LCD_Lijn1
Error[113]  : Symbol not previously defined (LATE)
00006C 9000               M         bcf             LATE,0          ; RS laag
Error[113]  : Symbol not previously defined (LATE)
00006E 9400               M         bcf             LATE,2          ; E laag
000070 0E80               M         movlw   B'10000000'     ; move cursor to display (adres 0 = 1e lijn)
Error[113]  : Symbol not previously defined (LATD)
000072 6E00               M         movwf   LATD
000074 EC?? F???          M         call    Epuls
Error[113]  : Symbol not previously defined (LATE)
000078 8000               M         bsf             LATE,0          ; RS hoog
Error[113]  : Symbol not previously defined (LATE)
00007A 9400               M         bcf             LATE,2          ; E laag
                          M         
                      00141 
00007C 0E05           00142         movlw D'5'
00007E 6E??           00143         movwf getal1
                      00144 
000080 0E03           00145         movlw D'3'
000082 6E??           00146         movwf getal2
                      00147                 
000084 50??           00148         movf getal1,W
000086 26??           00149         addwf som
000088 50??           00150         movf getal2,W
00008A 26??           00151         addwf som
                      00152 
Error[113]  : Symbol not previously defined (LATD)
00008C C??? F000      00153         movff getal1,LATD
000090 EC?? F???      00154         call Epuls
                      00155         
000094 0E2B           00156         movlw "+"
Error[113]  : Symbol not previously defined (LATD)
000096 6E00           00157         movwf LATD
000098 EC?? F???      00158         call Epuls
                      00159         
Error[113]  : Symbol not previously defined (LATD)
00009C C??? F000      00160         movff getal2,LATD
0000A0 EC?? F???      00161         call Epuls
                      00162         
0000A4 0E3D           00163         movlw "=" 
Error[113]  : Symbol not previously defined (LATD)
0000A6 6E00           00164         movwf LATD
0000A8 EC?? F???      00165         call Epuls
                      00166         
Error[113]  : Symbol not previously defined (LATD)
MPASM 5.61                      ../EXTRA.ASM   3-4-2015  10:01:34         PAGE  8


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0000AC C??? F000      00167         movff som,LATD
0000B0 EC?? F???      00168         call Epuls
                      00169 
                      00170 
0000B4                00171 lus:
0000B4 D???           00172                 bra lus  ;
                      00173 
                      00174 ; ============
                      00175 ; SUBROUTINES
                      00176 ; ============
                      00177 
                      00178 #include "subroutine.asm"
                      00001 ; ============
                      00002 ; SUBROUTINES
                      00003 ; ============
                      00004 
                      00005 
                      00006 ; Versturen puls naar enable - LCD op Dwengo bord
                      00007 ; ===============================================
0000B6                00008 Epuls
0000B6 EC?? F???      00009         call    DelayLCD        ; wachten
Error[113]  : Symbol not previously defined (LATE)
0000BA 8400           00010         bsf             LATE,2          ; E hoog maken
0000BC EC?? F???      00011         call    DelayLCD        ; wachten
Error[113]  : Symbol not previously defined (LATE)
0000C0 9400           00012         bcf             LATE,2          ; E laag maken
0000C2 0012           00013         return
                      00014 
                      00015         
                      00016 ; Delay routine - LCD op Dwengo bord
                      00017 ; ==================================
0000C4                00018 DelayLCD                                ; moet minimaal 160µs zijn (48MHz)
0000C4 0E0F           00019         movlw   0x0F
0000C6 6E??           00020         movwf   DVAR1
0000C8                00021 Delay1
0000C8 0EFF           00022         movlw   0xFF
0000CA 6E??           00023         movwf   DVAR2
0000CC                00024 Delay2
0000CC 2E??           00025         decfsz  DVAR2
0000CE EF?? F???      00026         goto    Delay2
0000D2 2E??           00027         decfsz  DVAR1
0000D4 EF?? F???      00028         goto    Delay1
0000D8 0012           00029         return
                      00030 
                      00031 ; Delay routine - algemeen
                      00032 ; ========================
                      00033 
0000DA                00034 Delay
0000DA 0E10           00035         movlw   0x10                    ;stel hier duur delay in
0000DC 6E??           00036         movwf   DVAR3
0000DE                00037 DelayExtra
0000DE 0EFF           00038         movlw   0xFF
0000E0 6E??           00039         movwf   DVAR2           
MPASM 5.61                      ../EXTRA.ASM   3-4-2015  10:01:34         PAGE  9


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0000E2                00040 DelayOuter
0000E2 0EFF           00041         movlw   0xFF
0000E4 6E??           00042         movwf   DVAR1           
0000E6                00043 DelayInner
0000E6 2E??           00044         decfsz  DVAR1
0000E8 EF?? F???      00045         goto    DelayInner
0000EC 2E??           00046         decfsz  DVAR2
0000EE EF?? F???      00047         goto    DelayOuter
0000F2 2E??           00048         decfsz  DVAR3
0000F4 EF?? F???      00049         goto    DelayExtra
0000F8 0012           00050         return
                      00051 
                      00052 ; Decimaal getal splitsen in cijfers (max. 255)
                      00053 ; =============================================
                      00054 
0000FA                00055 omzettingDecimaal
0000FA 6A??           00056        clrf    eenheid
0000FC 6A??           00057        clrf    tiental
0000FE 6A??           00058        clrf    honderdtal
000100                00059 deling1
000100 6A??           00060        clrf    quotient
000102                00061 lusdeling1
000102 2A??           00062        incf    quotient                        ;quotient verhogen
000104 0E0A           00063        movlw   D'10'
000106 5E??           00064        subwf   deeltal                       ;tien aftrekken
000108 E2??           00065        bc      lusdeling1                      ;zolang resultaat groter dan nul was blijven uitvoeren
00010A 26??           00066        addwf   deeltal                         ;1 keer te veel afgetrokken, weer bijtellen
00010C C??? F???      00067        movff   deeltal,eenheid
000110 06??           00068        decf    quotient                        ;quotient een keer te veel verhoogd, weer verminderen
                      00069 
                      00070        ;quotiënt eerste deling bestaat nog uit twee decimale cijfers
                      00071        ;opnieuw "delen", rest is cijfer voor tientallen, quotient is cijfer voor honderdtallen
000112 C??? F???      00072        movff   quotient,deeltal
000116                00073 deling2
000116 6A??           00074        clrf    quotient
000118                00075 lusdeling2
000118 2A??           00076        incf    quotient
00011A 0E0A           00077        movlw   D'10'
00011C 5E??           00078        subwf   deeltal
00011E E2??           00079        bc      lusdeling2
000120 26??           00080        addwf   deeltal
000122 C??? F???      00081        movff   deeltal,tiental
000126 06??           00082        decf    quotient
000128 C??? F???      00083            movff   quotient,honderdtal
00012C 0012           00084        return   
                      00179 
                      00180 ;******************************************************************************
                      00181 ;Einde programma
                      00182         
                      00183         END
MPASM 5.61                      ../EXTRA.ASM   3-4-2015  10:01:34         PAGE 10


SYMBOL TABLE
  LABEL                             VALUE 

BSR_TEMP                          00000302
DVAR1                             00000303
DVAR2                             00000304
DVAR3                             00000305
Delay                             000000DA
Delay1                            000000C8
Delay2                            000000CC
DelayExtra                        000000DE
DelayInner                        000000E6
DelayLCD                          000000C4
DelayLang                         00000036
DelayOuter                        000000E2
EXAMPLE                           00000000
Epuls                             000000B6
HighInt                           00000000
LCD_Char                          
LCD_Getal                         
LCD_Init                          
LCD_Lijn1                         
LCD_Lijn2                         
LowInt                            00000002
Main                              0000001C
STATUS_TEMP                       00000301
WREG_TEMP                         00000300
__18F4550                         00000001
deeltal                           00000309
deling1                           00000100
deling2                           00000116
eenheid                           00000308
getal1                            0000030C
getal2                            0000030D
honderdtal                        00000306
lus                               000000B4
lusdeling1                        00000102
lusdeling2                        00000118
omzettingDecimaal                 000000FA
quotient                          0000030A
som                               0000030E
tiental                           00000307
voorbeeld                         0000030B

Errors   :    34
Warnings :     0 reported,     0 suppressed
Messages :     0 reported,     0 suppressed

